<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ë¹„ì„œ ìƒë‹´ ì •ë¦¬ë´‡</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Pretendard', sans-serif;
            background: #f7f7f8;
            background-image: 
                radial-gradient(circle, #d1d5db 0.5px, transparent 0.5px);
            background-size: 24px 24px;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .chat-container {
            width: 100%;
            max-width: 1000px;
            height: 92vh;
            background: #ffffff;
            border-radius: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border: 1px solid #e5e7eb;
        }

        .chat-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 18px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }

        .header-title {
            flex: 1;
            text-align: center;
            font-size: 18px;
            font-weight: 500;
            letter-spacing: -0.3px;
            padding-right: 200px;
        }

        .header-actions {
            position: absolute;
            right: 29px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header-phone {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            font-weight: 400;
            opacity: 0.9;
            white-space: nowrap;
        }

        .phone-button {
            background: rgba(255, 255, 255, 0.2);
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .phone-button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .header-icon-button {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            opacity: 0.9;
        }

        .header-icon-button:hover {
            background: rgba(255, 255, 255, 0.25);
            opacity: 1;
            transform: translateY(-1px);
        }

        .header-icon-button svg {
            width: 18px;
            height: 18px;
            fill: white;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
            background: #ffffff;
        }

        /* ì‹œìŠ¤í…œ ì•ˆë‚´ ì¹´ë“œ */
        .system-notice-card {
            background: #f6f7f9;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 24px;
            font-size: 13px;
            color: #6b7280;
            line-height: 1.6;
        }

        .system-notice-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            user-select: none;
        }

        .system-notice-icon {
            font-size: 16px;
            margin-right: 8px;
        }

        .system-notice-title {
            flex: 1;
            font-weight: 500;
            color: #374151;
        }

        .system-notice-toggle {
            font-size: 12px;
            color: #9ca3af;
            transition: transform 0.2s;
        }

        .system-notice-card.collapsed .system-notice-toggle {
            transform: rotate(-90deg);
        }

        .system-notice-content {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #e5e7eb;
            display: block;
        }

        .system-notice-card.collapsed .system-notice-content {
            display: none;
        }

        .status-indicator {
            padding: 10px 14px;
            background: #f9fafb;
            border-radius: 10px;
            font-size: 13px;
            color: #6b7280;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
            border: 1px solid #e5e7eb;
        }

        .status-dot {
            width: 9px;
            height: 9px;
            border-radius: 50%;
            background: #10b981;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }

        .status-dot.disconnected {
            background: #ef4444;
            animation: none;
        }

        .message {
            margin-bottom: 24px;
            display: flex;
            align-items: flex-start;
            animation: fadeIn 0.4s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(8px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            justify-content: flex-end;
        }

        .message.bot {
            justify-content: flex-start;
        }

        .message-content {
            max-width: 80%;
            padding: 14px 18px;
            border-radius: 20px;
            word-wrap: break-word;
            white-space: pre-wrap;
            line-height: 1.7;
            font-size: 15px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-bottom-right-radius: 6px;
        }

        .message.bot .message-content {
            background: #f2f4f7;
            color: #1f2937;
            border-bottom-left-radius: 6px;
            border: 1px solid #e5e7eb;
        }

        /* ë²„íŠ¼ ê·¸ë£¹ (ìœ í˜• ì„ íƒìš©) */
        .button-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 12px;
        }

        .option-button {
            background: #ffffff;
            border: 1.5px solid #e5e7eb;
            border-radius: 14px;
            padding: 14px 18px;
            font-size: 15px;
            color: #1f2937;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
            font-weight: 400;
        }

        .option-button:hover {
            border-color: #667eea;
            background: #f8f9ff;
            transform: translateX(2px);
        }

        .option-button:active {
            transform: translateX(0);
        }

        .step-label {
            font-size: 13px;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 8px;
            display: block;
        }

        .chat-input-container {
            padding: 20px 24px;
            background: #ffffff;
            border-top: 1px solid #e5e7eb;
            flex-shrink: 0;
        }

        .input-wrapper {
            display: flex;
            gap: 12px;
            align-items: center;
            max-width: 100%;
        }

        .file-attach-button {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            background: #f3f4f6;
            border: 1.5px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .file-attach-button:hover {
            background: #e5e7eb;
            border-color: #667eea;
        }

        .file-attach-button:active {
            transform: scale(0.95);
        }

        .file-attach-button svg {
            width: 20px;
            height: 20px;
            fill: #6b7280;
            transition: fill 0.2s;
        }

        .file-attach-button:hover svg {
            fill: #667eea;
        }

        .file-attach-button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .chat-input {
            flex: 1;
            padding: 14px 20px;
            border: 1.5px solid #d1d5db;
            border-radius: 26px;
            font-size: 15px;
            outline: none;
            transition: all 0.2s ease;
            background: #ffffff;
            color: #1f2937;
            font-family: inherit;
        }

        .chat-input::placeholder {
            color: #9ca3af;
        }

        .chat-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.08);
        }

        .send-button {
            padding: 14px 28px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 26px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(102, 126, 234, 0.2);
            min-width: 80px;
        }

        .send-button:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
        }

        .send-button:active:not(:disabled) {
            transform: translateY(0);
            box-shadow: 0 1px 2px rgba(102, 126, 234, 0.2);
        }

        .send-button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2.5px solid #e5e7eb;
            border-top: 2.5px solid #667eea;
            border-radius: 50%;
            animation: spin 0.9s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background: #fef2f2;
            color: #dc2626;
            padding: 14px 18px;
            border-radius: 12px;
            margin-bottom: 16px;
            border-left: 3px solid #dc2626;
            font-size: 14px;
            line-height: 1.6;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ */
        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: transparent;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: #d1d5db;
            border-radius: 3px;
        }

        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: #9ca3af;
        }

        .hidden {
            display: none !important;
        }

        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: white;
            border-radius: 16px;
            padding: 24px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal-overlay.active .modal {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid #e5e7eb;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: #1f2937;
        }

        .modal-close {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: none;
            background: #f3f4f6;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .modal-close:hover {
            background: #e5e7eb;
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #374151;
            margin-bottom: 8px;
        }

        .form-input,
        .form-textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1.5px solid #d1d5db;
            border-radius: 12px;
            font-size: 15px;
            font-family: inherit;
            transition: all 0.2s;
            background: white;
        }

        .form-textarea {
            resize: vertical;
            min-height: 120px;
        }

        .form-input:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .form-file-input {
            display: none;
        }

        .file-upload-area {
            border: 2px dashed #d1d5db;
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            background: #f9fafb;
        }

        .file-upload-area:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .file-upload-area.dragover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .file-list {
            margin-top: 12px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 12px;
            background: #f9fafb;
            border-radius: 8px;
            font-size: 14px;
        }

        .file-item-name {
            flex: 1;
            color: #374151;
        }

        .file-item-remove {
            color: #ef4444;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .file-item-remove:hover {
            background: #fee2e2;
        }

        .modal-footer {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #f3f4f6;
            color: #374151;
        }

        .btn-secondary:hover {
            background: #e5e7eb;
        }

        /* ë°˜ì‘í˜• ì²˜ë¦¬ */
        @media (max-width: 768px) {
            .header-title {
                padding-right: 200px;
                font-size: 16px;
            }

            .header-actions {
                right: 19px;
                gap: 8px;
            }

            .header-icon-button {
                width: 32px;
                height: 32px;
            }

            .header-icon-button svg {
                width: 16px;
                height: 16px;
            }

            .header-phone {
                font-size: 12px;
                gap: 6px;
            }

            .phone-button {
                padding: 5px 10px;
                font-size: 11px;
            }

            .modal {
                max-width: 90%;
                padding: 20px;
            }
        }

        @media (max-width: 480px) {
            .header-title {
                padding-right: 0;
                font-size: 15px;
            }

            .header-actions {
                position: static;
                transform: none;
                margin-left: auto;
                gap: 6px;
            }

            .header-icon-button {
                width: 28px;
                height: 28px;
            }

            .header-icon-button svg {
                width: 14px;
                height: 14px;
            }

            .header-phone {
                font-size: 11px;
            }

            .phone-button {
                padding: 4px 8px;
                font-size: 10px;
            }

            .chat-header {
                flex-wrap: wrap;
                padding: 14px 16px;
            }

            .modal {
                max-width: 95%;
                padding: 16px;
            }

            .modal-title {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <div class="header-title">
                AI ë¹„ì„œ ìƒë‹´ ì •ë¦¬ë´‡
            </div>
            <div class="header-actions">
                <div class="header-phone">
                    <span>â˜ 060-604-1000</span>
                    <span class="phone-button">ìƒë‹´ ì—°ê²°</span>
                </div>
                <div class="header-icon-button" onclick="openFileUpload()" title="íŒŒì¼ ì²¨ë¶€" style="display: none;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="17 8 12 3 7 8"></polyline>
                        <line x1="12" y1="3" x2="12" y2="15"></line>
                    </svg>
                </div>
                <div class="header-icon-button" onclick="openDirectWrite()" title="ì§ì ‘ ìƒë‹´ê¸€ ì“°ê¸°">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                        <polyline points="10 9 9 9 8 9"></polyline>
                    </svg>
                </div>
                <div class="header-icon-button" onclick="openBugReport()" title="ë²„ê·¸ ì‹ ê³ ">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                        <line x1="12" y1="9" x2="12" y2="13"></line>
                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                    </svg>
                </div>

            </div>
        </div>
        
        <div class="chat-messages" id="chatMessages">
            <!-- ì‹œìŠ¤í…œ ì•ˆë‚´ ì¹´ë“œ -->
            <div class="system-notice-card" id="systemNoticeCard">
                <div class="system-notice-header" onclick="toggleNotice()">
                    <div style="display: flex; align-items: center;">
                        <span class="system-notice-icon">â“˜</span>
                        <span class="system-notice-title">ì•ˆë‚´</span>
                    </div>
                    <span class="system-notice-toggle">â–¼</span>
                </div>
                <div class="system-notice-content">
                    ì´ ì„œë¹„ìŠ¤ëŠ” ë²•ë¥  ìë¬¸ì´ ì•„ë‹ˆë¼,<br>
                    ìƒë‹´ì„ ìœ„í•´ ì‚¬ì‹¤ê´€ê³„ë¥¼ ì •ë¦¬í•˜ëŠ” AI ë„ìš°ë¯¸ì…ë‹ˆë‹¤.<br>
                    ì •í™•í•œ íŒë‹¨ì€ ë³€í˜¸ì‚¬ ìƒë‹´ì´ í•„ìš”í•©ë‹ˆë‹¤.
                </div>
            </div>

            <div class="status-indicator hidden" id="statusIndicator">
                <span class="status-dot" id="statusDot"></span>
                <span id="statusText">ì—°ê²° ì¤‘...</span>
            </div>
        </div>

        <div class="chat-input-container">
            <div class="input-wrapper">
                <button class="file-attach-button" id="fileAttachButton" onclick="openFileUpload()" title="íŒŒì¼ ì²¨ë¶€" disabled>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="17 8 12 3 7 8"></polyline>
                        <line x1="12" y1="3" x2="12" y2="15"></line>
                    </svg>
                </button>
                <input 
                    type="text" 
                    class="chat-input" 
                    id="chatInput" 
                    placeholder="ì˜ˆ: 2024ë…„ 10ì›”, ì¤‘ê³ ê±°ë˜ë¡œ 30ë§Œ ì›ì„ ë³´ëƒˆëŠ”ë° ë¬¼ê±´ì„ ë°›ì§€ ëª»í–ˆê³  ì—°ë½ì´ ëŠê²¼ìŠµë‹ˆë‹¤." 
                    disabled
                />
                <button class="send-button" id="sendButton" disabled>ì „ì†¡</button>
            </div>
        </div>
    </div>

    <!-- ë²„ê·¸ ì‹ ê³  ëª¨ë‹¬ -->
    <div class="modal-overlay" id="bugReportModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">ë²„ê·¸ ì‹ ê³ </h3>
                <button class="modal-close" onclick="closeModal('bugReportModal')">âœ•</button>
            </div>
            <div class="modal-body">
                <form id="bugReportForm">
                    <div class="form-group">
                        <label class="form-label">ë°œìƒí•œ ë¬¸ì œë¥¼ ì„¤ëª…í•´ì£¼ì„¸ìš”</label>
                        <textarea class="form-textarea" id="bugDescription" placeholder="ì–´ë–¤ ë¬¸ì œê°€ ë°œìƒí–ˆëŠ”ì§€ ìì„¸íˆ ì„¤ëª…í•´ì£¼ì„¸ìš”." required></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ì¬í˜„ ë°©ë²• (ì„ íƒì‚¬í•­)</label>
                        <textarea class="form-textarea" id="bugSteps" placeholder="ë¬¸ì œë¥¼ ì¬í˜„í•˜ëŠ” ë°©ë²•ì„ ë‹¨ê³„ë³„ë¡œ ì ì–´ì£¼ì„¸ìš”."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ê¸°ê¸° ì •ë³´ (ì„ íƒì‚¬í•­)</label>
                        <input type="text" class="form-input" id="bugDevice" placeholder="ì˜ˆ: Chrome ë¸Œë¼ìš°ì €, Windows 10">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('bugReportModal')">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="submitBugReport()">ì‹ ê³ í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <!-- ì§ì ‘ ê¸€ì“°ê¸° ëª¨ë‹¬ -->
    <div class="modal-overlay" id="directWriteModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">ì§ì ‘ ìƒë‹´ê¸€ ì“°ê¸°</h3>
                <button class="modal-close" onclick="closeModal('directWriteModal')">âœ•</button>
            </div>
            <div class="modal-body">
                <form id="directWriteForm">
                    <div class="form-group">
                        <label class="form-label">ìƒë‹´ ë‚´ìš©</label>
                        <textarea class="form-textarea" id="directWriteContent" placeholder="ìƒë‹´í•˜ê³  ì‹¶ì€ ë‚´ìš©ì„ ìì„¸íˆ ì‘ì„±í•´ì£¼ì„¸ìš”.&#10;&#10;ì˜ˆ:&#10;- ì–¸ì œ, ì–´ë””ì„œ ë°œìƒí–ˆëŠ”ì§€&#10;- ê´€ë ¨ëœ ì‚¬ëŒì´ë‚˜ ê¸°ê´€&#10;- í˜„ì¬ ìƒí™©ê³¼ ì›í•˜ëŠ” ê²°ê³¼" required></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('directWriteModal')">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="submitDirectWrite()">ì‘ì„± ì™„ë£Œ</button>
            </div>
        </div>
    </div>

    <!-- íŒŒì¼ ì²¨ë¶€ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="fileUploadModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">íŒŒì¼ ì²¨ë¶€</h3>
                <button class="modal-close" onclick="closeModal('fileUploadModal')">âœ•</button>
            </div>
            <div class="modal-body">
                <form id="fileUploadForm">
                    <div class="form-group">
                        <label class="form-label">íŒŒì¼ ì„ íƒ</label>
                        <div class="file-upload-area" id="fileUploadArea" onclick="document.getElementById('fileInput').click()">
                            <div>
                                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2" style="margin: 0 auto 12px;">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="17 8 12 3 7 8"></polyline>
                                    <line x1="12" y1="3" x2="12" y2="15"></line>
                                </svg>
                                <p style="color: #6b7280; margin: 0;">í´ë¦­í•˜ê±°ë‚˜ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì—¬ ì—…ë¡œë“œ</p>
                                <p style="color: #9ca3af; font-size: 12px; margin: 8px 0 0 0;">PDF, ì´ë¯¸ì§€, ë¬¸ì„œ íŒŒì¼ (ìµœëŒ€ 10MB)</p>
                            </div>
                        </div>
                        <input type="file" id="fileInput" class="form-file-input" multiple accept=".pdf,.jpg,.jpeg,.png,.doc,.docx,.txt">
                        <div class="file-list" id="fileList"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">íŒŒì¼ ì„¤ëª… (ì„ íƒì‚¬í•­)</label>
                        <textarea class="form-textarea" id="fileDescription" placeholder="ì²¨ë¶€í•œ íŒŒì¼ì— ëŒ€í•œ ê°„ë‹¨í•œ ì„¤ëª…ì„ ì ì–´ì£¼ì„¸ìš”."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('fileUploadModal')">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="submitFileUpload()">ì²¨ë¶€ ì™„ë£Œ</button>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = window.location.origin;
        let sessionId = null;
        let isProcessing = false;
        let currentStep = 'greeting';

        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const sendButton = document.getElementById('sendButton');
        const statusIndicator = document.getElementById('statusIndicator');
        const statusDot = document.getElementById('statusDot');
        const statusText = document.getElementById('statusText');

        // ì‹œìŠ¤í…œ ì•ˆë‚´ ì¹´ë“œ ì ‘ê¸°/í¼ì¹˜ê¸°
        function toggleNotice() {
            const card = document.getElementById('systemNoticeCard');
            card.classList.toggle('collapsed');
        }

        // ì„¸ì…˜ ì‹œì‘
        async function startSession() {
            try {
                statusIndicator.classList.remove('hidden');
                updateStatus('ì„¸ì…˜ ì‹œì‘ ì¤‘...', false);
                
                const response = await fetch(`${API_BASE_URL}/chat/start`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        channel: 'web',
                        user_id: `user_${Date.now()}`,
                        device: 'desktop'
                    })
                });

                const data = await response.json();
                
                if (data.success && data.data) {
                    sessionId = data.data.session_id;
                    
                    // AI ì²« ë©”ì‹œì§€ (ê°„ë‹¨í•œ ì¸ì‚¬)
                    setTimeout(() => {
                        addMessage('bot', 'ì•ˆë…•í•˜ì„¸ìš”.\nìƒë‹´ ì „ì— ìƒí™©ì„ ì •ë¦¬í•´ë“œë¦´ê²Œìš”.\n\nì•„ë˜ ì§ˆë¬¸ì— í¸í•˜ê²Œ ë‹µí•´ì£¼ì‹œë©´,\në³€í˜¸ì‚¬ ìƒë‹´ì— í•„ìš”í•œ í•µì‹¬ë§Œ ì •ë¦¬í•´ë“œë¦½ë‹ˆë‹¤.');
                        
                        // STEP 1 ë©”ì‹œì§€
                        setTimeout(() => {
                            addStepMessage('STEP 1. ì–´ë–¤ ì¼ì´ ìˆì—ˆë‚˜ìš”?', 
                                'ì–¸ì œ / ëˆ„êµ¬ì™€ / ì–´ë–¤ ì¼ì´ ìˆì—ˆëŠ”ì§€\n3~5ì¤„ë¡œ í¸í•˜ê²Œ ì ì–´ì£¼ì„¸ìš”.\n(ê¸ˆì•¡, ì¦ê±°ê°€ ìˆë‹¤ë©´ í•¨ê»˜ ì ì–´ì£¼ì‹œë©´ ì¢‹ì•„ìš”)');
                            currentStep = 'situation';
                        }, 500);
                    }, 300);
                    
                    chatInput.disabled = false;
                    sendButton.disabled = false;
                    document.getElementById('fileAttachButton').disabled = false;
                    updateStatus('ì—°ê²°ë¨', true);
                    statusIndicator.classList.add('hidden');
                } else {
                    throw new Error(data.error?.message || 'ì„¸ì…˜ ì‹œì‘ ì‹¤íŒ¨');
                }
            } catch (error) {
                console.error('ì„¸ì…˜ ì‹œì‘ ì˜¤ë¥˜:', error);
                addErrorMessage(`ì„¸ì…˜ ì‹œì‘ ì‹¤íŒ¨: ${error.message}`);
                updateStatus('ì—°ê²° ì‹¤íŒ¨', false);
            }
        }

        // STEP ë©”ì‹œì§€ ì¶”ê°€
        function addStepMessage(stepLabel, content) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.innerHTML = `<span class="step-label">${stepLabel}</span>${content}`;
            
            messageDiv.appendChild(contentDiv);
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // ë²„íŠ¼ ê·¸ë£¹ ì¶”ê°€ (ìœ í˜• ì„ íƒìš©)
        function addButtonGroup(stepLabel, buttons) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            
            const label = document.createElement('span');
            label.className = 'step-label';
            label.textContent = stepLabel;
            contentDiv.appendChild(label);
            
            const buttonGroup = document.createElement('div');
            buttonGroup.className = 'button-group';
            
            buttons.forEach(button => {
                const btn = document.createElement('button');
                btn.className = 'option-button';
                btn.textContent = button.text;
                btn.onclick = () => {
                    handleButtonClick(button.value, button.text);
                };
                buttonGroup.appendChild(btn);
            });
            
            contentDiv.appendChild(buttonGroup);
            messageDiv.appendChild(contentDiv);
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // ë²„íŠ¼ í´ë¦­ ì²˜ë¦¬
        function handleButtonClick(value, text) {
            // ì‚¬ìš©ì ì„ íƒ í‘œì‹œ
            addMessage('user', text);
            
            // ì„œë²„ì— ì „ì†¡
            sendButtonClick(value, text);
        }

        // ë©”ì‹œì§€ ì „ì†¡
        async function sendMessage() {
            const message = chatInput.value.trim();
            if (!message || isProcessing || !sessionId) return;

            addMessage('user', message);
            chatInput.value = '';
            chatInput.disabled = true;
            sendButton.disabled = true;
            document.getElementById('fileAttachButton').disabled = true;
            isProcessing = true;
            
            const loadingMessage = addMessage('bot', 'ì²˜ë¦¬ ì¤‘...', true);

            try {
                const response = await fetch(`${API_BASE_URL}/chat/message`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        session_id: sessionId,
                        user_message: message
                    })
                });

                const data = await response.json();
                
                loadingMessage.remove();

                if (data.success && data.data) {
                    handleBotResponse(data.data);
                } else {
                    throw new Error(data.error?.message || 'ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨');
                }
            } catch (error) {
                console.error('ë©”ì‹œì§€ ì „ì†¡ ì˜¤ë¥˜:', error);
                loadingMessage.remove();
                addErrorMessage(`ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨: ${error.message}`);
            } finally {
                chatInput.disabled = false;
                sendButton.disabled = false;
                document.getElementById('fileAttachButton').disabled = false;
                isProcessing = false;
                chatInput.focus();
            }
        }

        // ë²„íŠ¼ í´ë¦­ ì „ì†¡
        async function sendButtonClick(value, text) {
            if (isProcessing || !sessionId) return;

            chatInput.disabled = true;
            sendButton.disabled = true;
            document.getElementById('fileAttachButton').disabled = true;
            isProcessing = true;
            
            const loadingMessage = addMessage('bot', 'ì²˜ë¦¬ ì¤‘...', true);

            try {
                const response = await fetch(`${API_BASE_URL}/chat/message`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        session_id: sessionId,
                        user_message: text
                    })
                });

                const data = await response.json();
                
                loadingMessage.remove();

                if (data.success && data.data) {
                    handleBotResponse(data.data);
                } else {
                    throw new Error(data.error?.message || 'ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨');
                }
            } catch (error) {
                console.error('ë©”ì‹œì§€ ì „ì†¡ ì˜¤ë¥˜:', error);
                loadingMessage.remove();
                addErrorMessage(`ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨: ${error.message}`);
            } finally {
                chatInput.disabled = false;
                sendButton.disabled = false;
                document.getElementById('fileAttachButton').disabled = false;
                isProcessing = false;
                chatInput.focus();
            }
        }

        // ë´‡ ì‘ë‹µ ì²˜ë¦¬
        function handleBotResponse(data) {
            const botMessage = data.bot_message || 'ì‘ë‹µì´ ì—†ìŠµë‹ˆë‹¤.';
            
            // ìƒíƒœì— ë”°ë¼ ë‹¤ë¥¸ ì²˜ë¦¬
            const state = data.current_state || data.state;
            
            if (state === 'CASE_CLASSIFICATION' || state === 'case_classification') {
                // ìœ í˜• ì„ íƒ ë²„íŠ¼ í‘œì‹œ
                addButtonGroup('ğŸ§­ STEP 2. ì–´ë–¤ ìœ í˜•ì— ê°€ê¹Œìš´ê°€ìš”?', [
                    { text: 'ğŸ’° ëˆÂ·ê³„ì•½Â·ë¶€ë™ì‚°', value: 'contract' },
                    { text: 'ğŸš¨ ì‚¬ê¸°Â·í˜•ì‚¬', value: 'criminal' },
                    { text: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ ì´í˜¼Â·ê°€ì¡±', value: 'family' },
                    { text: 'ğŸ› í–‰ì •ì²˜ë¶„', value: 'administrative' }
                ]);
                currentStep = 'classification';
            } else {
                // ì¼ë°˜ ë©”ì‹œì§€ í‘œì‹œ
                addMessage('bot', botMessage);
            }
        }

        // ë©”ì‹œì§€ ì¶”ê°€
        function addMessage(type, content, isLoading = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            
            if (isLoading) {
                contentDiv.innerHTML = '<div class="loading"></div>';
            } else {
                contentDiv.textContent = content;
            }
            
            messageDiv.appendChild(contentDiv);
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            return messageDiv;
        }

        // ì—ëŸ¬ ë©”ì‹œì§€ ì¶”ê°€
        function addErrorMessage(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.textContent = message;
            chatMessages.appendChild(errorDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateStatus(text, connected) {
            statusText.textContent = text;
            if (connected) {
                statusDot.classList.remove('disconnected');
            } else {
                statusDot.classList.add('disconnected');
            }
        }

        // ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜ë“¤
        let selectedFiles = [];

        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('active');
            document.body.style.overflow = '';
        }

        function openBugReport() {
            openModal('bugReportModal');
        }

        function openDirectWrite() {
            openModal('directWriteModal');
        }

        function openFileUpload() {
            openModal('fileUploadModal');
            setupFileUpload();
        }

        function submitBugReport() {
            const description = document.getElementById('bugDescription').value;
            const steps = document.getElementById('bugSteps').value;
            const device = document.getElementById('bugDevice').value;

            if (!description.trim()) {
                alert('ë¬¸ì œ ì„¤ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // ë²„ê·¸ ì‹ ê³  ë°ì´í„° ì „ì†¡
            const bugData = {
                description: description,
                steps: steps,
                device: device,
                timestamp: new Date().toISOString(),
                user_agent: navigator.userAgent,
                url: window.location.href
            };

            // ì—¬ê¸°ì„œ ì„œë²„ë¡œ ì „ì†¡í•˜ê±°ë‚˜ ë¡œì»¬ì— ì €ì¥
            console.log('ë²„ê·¸ ì‹ ê³ :', bugData);
            
            // ì‹¤ì œë¡œëŠ” API í˜¸ì¶œ
            // fetch(`${API_BASE_URL}/bug/report`, { ... })

            alert('ë²„ê·¸ ì‹ ê³ ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤!');
            document.getElementById('bugReportForm').reset();
            closeModal('bugReportModal');
        }

        function submitDirectWrite() {
            const content = document.getElementById('directWriteContent').value;

            if (!content.trim()) {
                alert('ìƒë‹´ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // ì§ì ‘ ì‘ì„±í•œ ë‚´ìš©ì„ ì±„íŒ…ì— ì¶”ê°€
            if (sessionId) {
                addMessage('user', content);
                sendDirectWrite(content);
            } else {
                alert('ì„¸ì…˜ì´ ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            }

            document.getElementById('directWriteForm').reset();
            closeModal('directWriteModal');
        }

        async function sendDirectWrite(content) {
            if (isProcessing || !sessionId) return;

            chatInput.disabled = true;
            sendButton.disabled = true;
            document.getElementById('fileAttachButton').disabled = true;
            isProcessing = true;
            
            const loadingMessage = addMessage('bot', 'ì²˜ë¦¬ ì¤‘...', true);

            try {
                const response = await fetch(`${API_BASE_URL}/chat/message`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        session_id: sessionId,
                        user_message: content
                    })
                });

                const data = await response.json();
                loadingMessage.remove();

                if (data.success && data.data) {
                    handleBotResponse(data.data);
                } else {
                    throw new Error(data.error?.message || 'ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨');
                }
            } catch (error) {
                console.error('ë©”ì‹œì§€ ì „ì†¡ ì˜¤ë¥˜:', error);
                loadingMessage.remove();
                addErrorMessage(`ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨: ${error.message}`);
            } finally {
                chatInput.disabled = false;
                sendButton.disabled = false;
                document.getElementById('fileAttachButton').disabled = false;
                isProcessing = false;
                chatInput.focus();
            }
        }

        function setupFileUpload() {
            const fileInput = document.getElementById('fileInput');
            const fileUploadArea = document.getElementById('fileUploadArea');
            const fileList = document.getElementById('fileList');

            // íŒŒì¼ ì„ íƒ ì´ë²¤íŠ¸
            fileInput.addEventListener('change', (e) => {
                handleFiles(e.target.files);
            });

            // ë“œë˜ê·¸ ì•¤ ë“œë¡­
            fileUploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                fileUploadArea.classList.add('dragover');
            });

            fileUploadArea.addEventListener('dragleave', () => {
                fileUploadArea.classList.remove('dragover');
            });

            fileUploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                fileUploadArea.classList.remove('dragover');
                handleFiles(e.dataTransfer.files);
            });
        }

        function handleFiles(files) {
            const maxSize = 10 * 1024 * 1024; // 10MB
            const allowedTypes = ['.pdf', '.jpg', '.jpeg', '.png', '.doc', '.docx', '.txt'];

            Array.from(files).forEach(file => {
                // íŒŒì¼ í¬ê¸° í™•ì¸
                if (file.size > maxSize) {
                    alert(`íŒŒì¼ "${file.name}"ì´(ê°€) ë„ˆë¬´ í½ë‹ˆë‹¤. (ìµœëŒ€ 10MB)`);
                    return;
                }

                // íŒŒì¼ íƒ€ì… í™•ì¸
                const fileExt = '.' + file.name.split('.').pop().toLowerCase();
                if (!allowedTypes.includes(fileExt)) {
                    alert(`ì§€ì›í•˜ì§€ ì•ŠëŠ” íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤: ${fileExt}`);
                    return;
                }

                // íŒŒì¼ ëª©ë¡ì— ì¶”ê°€
                selectedFiles.push(file);
                addFileToList(file);
            });
        }

        function addFileToList(file) {
            const fileList = document.getElementById('fileList');
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item';
            fileItem.innerHTML = `
                <span class="file-item-name">${file.name} (${formatFileSize(file.size)})</span>
                <span class="file-item-remove" onclick="removeFile('${file.name}')">âœ•</span>
            `;
            fileList.appendChild(fileItem);
        }

        function removeFile(fileName) {
            selectedFiles = selectedFiles.filter(file => file.name !== fileName);
            updateFileList();
        }

        function updateFileList() {
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = '';
            selectedFiles.forEach(file => addFileToList(file));
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        async function submitFileUpload() {
            if (selectedFiles.length === 0) {
                alert('íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            if (!sessionId) {
                alert('ì„¸ì…˜ì´ ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                return;
            }

            const description = document.getElementById('fileDescription').value;
            const formData = new FormData();
            
            // íŒŒì¼ ì¶”ê°€
            selectedFiles.forEach((file) => {
                formData.append('files', file);
            });
            
            formData.append('session_id', sessionId);
            if (description) {
                formData.append('description', description);
            }

            // UI ë¹„í™œì„±í™”
            const submitButton = document.querySelector('#fileUploadModal .btn-primary');
            const originalText = submitButton.textContent;
            submitButton.disabled = true;
            submitButton.textContent = 'ì—…ë¡œë“œ ì¤‘...';

            try {
                // íŒŒì¼ ì—…ë¡œë“œ API í˜¸ì¶œ
                const response = await fetch(`${API_BASE_URL}/chat/upload`, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success && data.data) {
                    const fileNames = selectedFiles.map(f => f.name).join(', ');
                    const uploadMessage = `[íŒŒì¼ ì²¨ë¶€] ${fileNames}${description ? '\n' + description : ''}`;
                    
                    // ì±„íŒ…ì— íŒŒì¼ ì²¨ë¶€ ë©”ì‹œì§€ ì¶”ê°€
                    addMessage('user', uploadMessage);
                    
                    alert(`${data.data.uploaded_count}ê°œì˜ íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.`);
                } else {
                    throw new Error(data.error?.message || 'íŒŒì¼ ì—…ë¡œë“œ ì‹¤íŒ¨');
                }
            } catch (error) {
                console.error('íŒŒì¼ ì—…ë¡œë“œ ì˜¤ë¥˜:', error);
                alert(`íŒŒì¼ ì—…ë¡œë“œ ì‹¤íŒ¨: ${error.message}`);
            } finally {
                // UI í™œì„±í™”
                submitButton.disabled = false;
                submitButton.textContent = originalText;
                
                // ì´ˆê¸°í™”
                selectedFiles = [];
                document.getElementById('fileUploadForm').reset();
                updateFileList();
                closeModal('fileUploadModal');
            }
        }

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal-overlay')) {
                e.target.classList.remove('active');
                document.body.style.overflow = '';
            }
        });

        // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                const activeModal = document.querySelector('.modal-overlay.active');
                if (activeModal) {
                    activeModal.classList.remove('active');
                    document.body.style.overflow = '';
                }
            }
        });

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        sendButton.addEventListener('click', sendMessage);
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // ì´ˆê¸°í™”
        startSession();
    </script>
</body>
</html>
